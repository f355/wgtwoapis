syntax = "proto3";

package wgtwo.events.v0;
option java_multiple_files = true;
option java_package = "com.wgtwo.api.events.v0";

import "google/protobuf/timestamp.proto";
import "wgtwo/common/phonenumber.proto";

service EventsService {
  rpc Subscribe (SubscribeEventsRequest) returns (stream SubscribeEventsResponse) {}
}

enum EventType {
  UNSPECIFIED = 0;
  VOICE_EVENT = 1;
  VOICEMAIL_EVENT = 2;
}

message SubscribeEventsRequest {
  repeated EventType type = 1;
  oneof start_position {
    uint64 sequence_id = 2;
  }
}

message SubscribeEventsResponse {
  repeated Event event = 1;
}

message Event {
  uint64 sequence_id = 1;
  google.protobuf.Timestamp timestamp = 2;
  string service_id = 3;
  oneof event {
    VoiceEvent voice_event = 4;
    VoicemailEvent voicemail_event = 5;
  }
}

message VoiceEvent {
  enum VoiceEventType {
    UNSPECIFIED = 0;
    CALL_INITIATED = 1;
    CALL_RINGING = 2;
    CALL_ANSWERED = 3;
    CALL_ENDED = 4;
  }

  string call_id = 1;
  VoiceEventType type = 2;
  common.PhoneNumber from_number = 3;
  common.PhoneNumber to_number = 4;
}

message VoicemailEvent {
  enum VoicemailEventType {
    UNSPECIFIED = 0;
    NEW_VOICEMAIL = 1;
  }

  string voicemail_id = 1;
  VoicemailEventType type = 2;
  common.PhoneNumber from_number = 3;
  common.PhoneNumber to_number = 4;
}
